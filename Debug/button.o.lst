   1              		.cpu arm7tdmi
   2              		.fpu softvfp
   3              		.eabi_attribute 20, 1
   4              		.eabi_attribute 21, 1
   5              		.eabi_attribute 23, 3
   6              		.eabi_attribute 24, 1
   7              		.eabi_attribute 25, 1
   8              		.eabi_attribute 26, 1
   9              		.eabi_attribute 30, 6
  10              		.eabi_attribute 18, 4
  11              		.file	"button.c"
  21              	.Ltext0:
  22              		.file 1 "../button.c"
 2246              		.align	2
 2247              	int_count:
 2248 0000 00000000 		.space	4
 2249              		.text
 2250              		.align	2
 2252              	boton_confirmado:
 2253              	.LFB0:
   1:../button.c   **** /*********************************************************************************************
   2:../button.c   **** * Fichero:      button.c
   3:../button.c   **** * Autor:
   4:../button.c   **** * Descrip:      Funciones de manejo de los pulsadores (EINT6-7)
   5:../button.c   **** * Version:
   6:../button.c   **** *********************************************************************************************/
   7:../button.c   **** 
   8:../button.c   **** /*--- ficheros de cabecera ---*/
   9:../button.c   **** #include "button.h"
  10:../button.c   **** #include "8led.h"
  11:../button.c   **** #include "cola.h"
  12:../button.c   **** #include "eventos.h"
  13:../button.c   **** #include "timer2.h"
  14:../button.c   **** #include "timer3.h"
  15:../button.c   **** #include "44blib.h"
  16:../button.c   **** #include "44b.h"
  17:../button.c   **** #include "def.h"
  18:../button.c   **** 
  19:../button.c   **** /*--- variables globales del módulo ---*/
  20:../button.c   **** /* int_count la utilizamos para sacar un número por el 8led.
  21:../button.c   ****   Cuando se pulsa un botón sumamos y con el otro restamos. ¡A veces hay rebotes! */
  22:../button.c   **** static unsigned int int_count = 0;
  23:../button.c   **** 
  24:../button.c   **** /* Callback para recibir la confirmación de pulsaciones filtradas por el timer3 */
  25:../button.c   **** static void boton_confirmado(uint8_t boton_id)
  26:../button.c   **** {
 2254              		.loc 1 26 0
 2255              		.cfi_startproc
 2256              		@ Function supports interworking.
 2257              		@ args = 0, pretend = 0, frame = 8
 2258              		@ frame_needed = 1, uses_anonymous_args = 0
 2259 0000 0DC0A0E1 		mov	ip, sp
 2260              	.LCFI0:
 2261              		.cfi_def_cfa_register 12
 2262 0004 00D82DE9 		stmfd	sp!, {fp, ip, lr, pc}
 2263 0008 04B04CE2 		sub	fp, ip, #4
 2264              		.cfi_offset 14, -8
 2265              		.cfi_offset 13, -12
 2266              		.cfi_offset 11, -16
 2267              	.LCFI1:
 2268              		.cfi_def_cfa 11, 4
 2269 000c 08D04DE2 		sub	sp, sp, #8
 2270 0010 0030A0E1 		mov	r3, r0
 2271 0014 0D304BE5 		strb	r3, [fp, #-13]
  27:../button.c   ****         switch (boton_id)
 2272              		.loc 1 27 0
 2273 0018 0D305BE5 		ldrb	r3, [fp, #-13]	@ zero_extendqisi2
 2274 001c 040053E3 		cmp	r3, #4
 2275 0020 0200000A 		beq	.L3
 2276 0024 080053E3 		cmp	r3, #8
 2277 0028 0E00000A 		beq	.L4
  28:../button.c   ****         {
  29:../button.c   ****                 case EVENTO_BOTON_IZQUIERDO:
  30:../button.c   ****                         int_count++;
  31:../button.c   ****                         cola_depuracion(timer2_count(), EVENTO_BOTON_IZQUIERDO, int_count);
  32:../button.c   ****                         break;
  33:../button.c   ****                 case EVENTO_BOTON_DERECHO:
  34:../button.c   ****                         int_count--;
  35:../button.c   ****                         cola_depuracion(timer2_count(), EVENTO_BOTON_DERECHO, int_count);
  36:../button.c   ****                         break;
  37:../button.c   ****                 default:
  38:../button.c   ****                         // No guardar eventos descartados
  39:../button.c   ****                         break;
 2278              		.loc 1 39 0
 2279 002c 1B0000EA 		b	.L5
 2280              	.L3:
  30:../button.c   ****                         int_count++;
 2281              		.loc 1 30 0
 2282 0030 88309FE5 		ldr	r3, .L6
 2283 0034 003093E5 		ldr	r3, [r3, #0]
 2284 0038 012083E2 		add	r2, r3, #1
 2285 003c 7C309FE5 		ldr	r3, .L6
 2286 0040 002083E5 		str	r2, [r3, #0]
  31:../button.c   ****                         cola_depuracion(timer2_count(), EVENTO_BOTON_IZQUIERDO, int_count);
 2287              		.loc 1 31 0
 2288 0044 FEFFFFEB 		bl	timer2_count
 2289 0048 0020A0E1 		mov	r2, r0
 2290 004c 6C309FE5 		ldr	r3, .L6
 2291 0050 003093E5 		ldr	r3, [r3, #0]
 2292 0054 0200A0E1 		mov	r0, r2
 2293 0058 0410A0E3 		mov	r1, #4
 2294 005c 0320A0E1 		mov	r2, r3
 2295 0060 FEFFFFEB 		bl	cola_depuracion
  32:../button.c   ****                         break;
 2296              		.loc 1 32 0
 2297 0064 0D0000EA 		b	.L5
 2298              	.L4:
  34:../button.c   ****                         int_count--;
 2299              		.loc 1 34 0
 2300 0068 50309FE5 		ldr	r3, .L6
 2301 006c 003093E5 		ldr	r3, [r3, #0]
 2302 0070 012043E2 		sub	r2, r3, #1
 2303 0074 44309FE5 		ldr	r3, .L6
 2304 0078 002083E5 		str	r2, [r3, #0]
  35:../button.c   ****                         cola_depuracion(timer2_count(), EVENTO_BOTON_DERECHO, int_count);
 2305              		.loc 1 35 0
 2306 007c FEFFFFEB 		bl	timer2_count
 2307 0080 0020A0E1 		mov	r2, r0
 2308 0084 34309FE5 		ldr	r3, .L6
 2309 0088 003093E5 		ldr	r3, [r3, #0]
 2310 008c 0200A0E1 		mov	r0, r2
 2311 0090 0810A0E3 		mov	r1, #8
 2312 0094 0320A0E1 		mov	r2, r3
 2313 0098 FEFFFFEB 		bl	cola_depuracion
  36:../button.c   ****                         break;
 2314              		.loc 1 36 0
 2315 009c 0000A0E1 		mov	r0, r0	@ nop
 2316              	.L5:
  40:../button.c   ****         }
  41:../button.c   **** 
  42:../button.c   ****         D8Led_symbol(int_count & 0x000f);
 2317              		.loc 1 42 0
 2318 00a0 18309FE5 		ldr	r3, .L6
 2319 00a4 003093E5 		ldr	r3, [r3, #0]
 2320 00a8 0F3003E2 		and	r3, r3, #15
 2321 00ac 0300A0E1 		mov	r0, r3
 2322 00b0 FEFFFFEB 		bl	D8Led_symbol
  43:../button.c   **** }
 2323              		.loc 1 43 0
 2324 00b4 0CD04BE2 		sub	sp, fp, #12
 2325 00b8 00689DE8 		ldmfd	sp, {fp, sp, lr}
 2326 00bc 1EFF2FE1 		bx	lr
 2327              	.L7:
 2328              		.align	2
 2329              	.L6:
 2330 00c0 00000000 		.word	int_count
 2331              		.cfi_endproc
 2332              	.LFE0:
 2334              		.align	2
 2335              		.global	Eint4567_ISR
 2337              	Eint4567_ISR:
 2338              	.LFB1:
  44:../button.c   **** 
  45:../button.c   **** /* declaración de función que es rutina de servicio de interrupción
  46:../button.c   ****  * https://gcc.gnu.org/onlinedocs/gcc/ARM-Function-Attributes.html */
  47:../button.c   **** void Eint4567_ISR(void) __attribute__((interrupt("IRQ")));
  48:../button.c   **** 
  49:../button.c   **** /*--- código de funciones ---*/
  50:../button.c   **** void Eint4567_ISR(void)
  51:../button.c   **** {
 2339              		.loc 1 51 0
 2340              		.cfi_startproc
 2341              		@ Interrupt Service Routine.
 2342              		@ args = 0, pretend = 0, frame = 8
 2343              		@ frame_needed = 1, uses_anonymous_args = 0
 2344 00c4 04C02DE5 		str	ip, [sp, #-4]!
 2345 00c8 0DC0A0E1 		mov	ip, sp
 2346              	.LCFI2:
 2347              		.cfi_def_cfa_register 12
 2348 00cc 0FD82DE9 		stmfd	sp!, {r0, r1, r2, r3, fp, ip, lr, pc}
 2349 00d0 04B04CE2 		sub	fp, ip, #4
 2350              		.cfi_offset 14, -8
 2351              		.cfi_offset 13, -12
 2352              		.cfi_offset 11, -16
 2353              		.cfi_offset 3, -20
 2354              		.cfi_offset 2, -24
 2355              		.cfi_offset 1, -28
 2356              		.cfi_offset 0, -32
 2357              	.LCFI3:
 2358              		.cfi_def_cfa 11, 4
 2359 00d4 08D04DE2 		sub	sp, sp, #8
  52:../button.c   ****         /* Identificar la interrupción (hay dos pulsadores) */
  53:../button.c   ****         unsigned int pending = rEXTINTPND & 0xF;
 2360              		.loc 1 53 0
 2361 00d8 8C309FE5 		ldr	r3, .L12
 2362 00dc 003093E5 		ldr	r3, [r3, #0]
 2363 00e0 0F3003E2 		and	r3, r3, #15
 2364 00e4 24300BE5 		str	r3, [fp, #-36]
  54:../button.c   ****         uint8_t boton_id = 0;
 2365              		.loc 1 54 0
 2366 00e8 0030A0E3 		mov	r3, #0
 2367 00ec 1D304BE5 		strb	r3, [fp, #-29]
  55:../button.c   **** 
  56:../button.c   ****         if (pending & 0x4)
 2368              		.loc 1 56 0
 2369 00f0 24301BE5 		ldr	r3, [fp, #-36]
 2370 00f4 043003E2 		and	r3, r3, #4
 2371 00f8 000053E3 		cmp	r3, #0
 2372 00fc 0200000A 		beq	.L9
  57:../button.c   ****         {
  58:../button.c   ****                 boton_id = EVENTO_BOTON_IZQUIERDO;
 2373              		.loc 1 58 0
 2374 0100 0430A0E3 		mov	r3, #4
 2375 0104 1D304BE5 		strb	r3, [fp, #-29]
 2376 0108 050000EA 		b	.L10
 2377              	.L9:
  59:../button.c   ****         }
  60:../button.c   ****         else if (pending & 0x8)
 2378              		.loc 1 60 0
 2379 010c 24301BE5 		ldr	r3, [fp, #-36]
 2380 0110 083003E2 		and	r3, r3, #8
 2381 0114 000053E3 		cmp	r3, #0
 2382 0118 0100000A 		beq	.L10
  61:../button.c   ****         {
  62:../button.c   ****                 boton_id = EVENTO_BOTON_DERECHO;
 2383              		.loc 1 62 0
 2384 011c 0830A0E3 		mov	r3, #8
 2385 0120 1D304BE5 		strb	r3, [fp, #-29]
 2386              	.L10:
  63:../button.c   ****         }
  64:../button.c   **** 
  65:../button.c   ****         if (boton_id != 0U)
 2387              		.loc 1 65 0
 2388 0124 1D305BE5 		ldrb	r3, [fp, #-29]	@ zero_extendqisi2
 2389 0128 000053E3 		cmp	r3, #0
 2390 012c 0200000A 		beq	.L11
  66:../button.c   ****         {
  67:../button.c   ****                 /* No registrar la pulsación inicial, solo las confirmadas */
  68:../button.c   **** 
  69:../button.c   ****                 /* Iniciar la máquina de antirrebotes. Si está ocupada, no hacer nada */
  70:../button.c   ****                 timer3_start_antirrebote(boton_id);
 2391              		.loc 1 70 0
 2392 0130 1D305BE5 		ldrb	r3, [fp, #-29]	@ zero_extendqisi2
 2393 0134 0300A0E1 		mov	r0, r3
 2394 0138 FEFFFFEB 		bl	timer3_start_antirrebote
 2395              	.L11:
  71:../button.c   ****         }
  72:../button.c   **** 
  73:../button.c   ****         /* Finalizar ISR */
  74:../button.c   ****         rEXTINTPND = 0xf;                               // borra los bits en EXTINTPND
 2396              		.loc 1 74 0
 2397 013c 28309FE5 		ldr	r3, .L12
 2398 0140 0F20A0E3 		mov	r2, #15
 2399 0144 002083E5 		str	r2, [r3, #0]
  75:../button.c   ****         rI_ISPC   |= BIT_EINT4567;              // borra el bit pendiente en INTPND
 2400              		.loc 1 75 0
 2401 0148 20309FE5 		ldr	r3, .L12+4
 2402 014c 1C209FE5 		ldr	r2, .L12+4
 2403 0150 002092E5 		ldr	r2, [r2, #0]
 2404 0154 022682E3 		orr	r2, r2, #2097152
 2405 0158 002083E5 		str	r2, [r3, #0]
  76:../button.c   **** }
 2406              		.loc 1 76 0
 2407 015c 1CD04BE2 		sub	sp, fp, #28
 2408 0160 0F689DE8 		ldmfd	sp, {r0, r1, r2, r3, fp, sp, lr}
 2409 0164 04C09DE4 		ldmfd	sp!, {ip}
 2410 0168 04F05EE2 		subs	pc, lr, #4
 2411              	.L13:
 2412              		.align	2
 2413              	.L12:
 2414 016c 5400D201 		.word	30539860
 2415 0170 2400E001 		.word	31457316
 2416              		.cfi_endproc
 2417              	.LFE1:
 2419              		.align	2
 2420              		.global	Eint4567_init
 2422              	Eint4567_init:
 2423              	.LFB2:
  77:../button.c   **** 
  78:../button.c   **** void Eint4567_init(void)
  79:../button.c   **** {
 2424              		.loc 1 79 0
 2425              		.cfi_startproc
 2426              		@ Function supports interworking.
 2427              		@ args = 0, pretend = 0, frame = 0
 2428              		@ frame_needed = 1, uses_anonymous_args = 0
 2429 0174 0DC0A0E1 		mov	ip, sp
 2430              	.LCFI4:
 2431              		.cfi_def_cfa_register 12
 2432 0178 00D82DE9 		stmfd	sp!, {fp, ip, lr, pc}
 2433 017c 04B04CE2 		sub	fp, ip, #4
 2434              		.cfi_offset 14, -8
 2435              		.cfi_offset 13, -12
 2436              		.cfi_offset 11, -16
 2437              	.LCFI5:
 2438              		.cfi_def_cfa 11, 4
  80:../button.c   ****         /* Inicializar el temporizador dedicado a la eliminación de rebotes */
  81:../button.c   ****         timer3_init(boton_confirmado);
 2439              		.loc 1 81 0
 2440 0180 AC009FE5 		ldr	r0, .L15
 2441 0184 FEFFFFEB 		bl	timer3_init
  82:../button.c   **** 
  83:../button.c   ****         /* Configuracion del controlador de interrupciones. Estos registros están definidos en 44b
  84:../button.c   ****         rI_ISPC    = 0x3ffffff;         // Borra INTPND escribiendo 1s en I_ISPC
 2442              		.loc 1 84 0
 2443 0188 A8309FE5 		ldr	r3, .L15+4
 2444 018c 3F23E0E3 		mvn	r2, #-67108864
 2445 0190 002083E5 		str	r2, [r3, #0]
  85:../button.c   ****         rEXTINTPND = 0xf;               // Borra EXTINTPND escribiendo 1s en el propio registro
 2446              		.loc 1 85 0
 2447 0194 A0309FE5 		ldr	r3, .L15+8
 2448 0198 0F20A0E3 		mov	r2, #15
 2449 019c 002083E5 		str	r2, [r3, #0]
  86:../button.c   ****         rINTMOD    = 0x0;               // Configura las lineas como de tipo IRQ
 2450              		.loc 1 86 0
 2451 01a0 98309FE5 		ldr	r3, .L15+12
 2452 01a4 0020A0E3 		mov	r2, #0
 2453 01a8 002083E5 		str	r2, [r3, #0]
  87:../button.c   ****         rINTCON    = 0x1;               // Habilita int. vectorizadas y la linea IRQ (FIQ no)
 2454              		.loc 1 87 0
 2455 01ac 1E36A0E3 		mov	r3, #31457280
 2456 01b0 0120A0E3 		mov	r2, #1
 2457 01b4 002083E5 		str	r2, [r3, #0]
  88:../button.c   ****         rINTMSK    &= ~(BIT_EINT4567);  // habilitamos interrupcion linea eint4567 en vector de mas
 2458              		.loc 1 88 0
 2459 01b8 84309FE5 		ldr	r3, .L15+16
 2460 01bc 80209FE5 		ldr	r2, .L15+16
 2461 01c0 002092E5 		ldr	r2, [r2, #0]
 2462 01c4 0226C2E3 		bic	r2, r2, #2097152
 2463 01c8 002083E5 		str	r2, [r3, #0]
  89:../button.c   **** 
  90:../button.c   ****         /* Establece la rutina de servicio para Eint4567 */
  91:../button.c   ****         pISR_EINT4567 = (int) Eint4567_ISR;
 2464              		.loc 1 91 0
 2465 01cc 74309FE5 		ldr	r3, .L15+20
 2466 01d0 74209FE5 		ldr	r2, .L15+24
 2467 01d4 002083E5 		str	r2, [r3, #0]
  92:../button.c   **** 
  93:../button.c   ****         /* Configuracion del puerto G */
  94:../button.c   ****         rPCONG  = 0xffff;                       // Establece la funcion de los pines (EINT0-7)
 2468              		.loc 1 94 0
 2469 01d8 70309FE5 		ldr	r3, .L15+28
 2470 01dc 70209FE5 		ldr	r2, .L15+32
 2471 01e0 002083E5 		str	r2, [r3, #0]
  95:../button.c   ****         rPUPG   = 0x0;                  // Habilita el "pull up" del puerto
 2472              		.loc 1 95 0
 2473 01e4 6C309FE5 		ldr	r3, .L15+36
 2474 01e8 0020A0E3 		mov	r2, #0
 2475 01ec 002083E5 		str	r2, [r3, #0]
  96:../button.c   ****         rEXTINT = rEXTINT | 0x22222222;   // Configura las lineas de int. como de flanco de bajada
 2476              		.loc 1 96 0
 2477 01f0 64209FE5 		ldr	r2, .L15+40
 2478 01f4 60309FE5 		ldr	r3, .L15+40
 2479 01f8 001093E5 		ldr	r1, [r3, #0]
 2480 01fc 5C309FE5 		ldr	r3, .L15+44
 2481 0200 033081E1 		orr	r3, r1, r3
 2482 0204 003082E5 		str	r3, [r2, #0]
  97:../button.c   **** 
  98:../button.c   ****         /* Por precaucion, se vuelven a borrar los bits de INTPND y EXTINTPND */
  99:../button.c   ****         rEXTINTPND = 0xf;                               // borra los bits en EXTINTPND
 2483              		.loc 1 99 0
 2484 0208 2C309FE5 		ldr	r3, .L15+8
 2485 020c 0F20A0E3 		mov	r2, #15
 2486 0210 002083E5 		str	r2, [r3, #0]
 100:../button.c   ****         rI_ISPC   |= BIT_EINT4567;              // borra el bit pendiente en INTPND
 2487              		.loc 1 100 0
 2488 0214 1C309FE5 		ldr	r3, .L15+4
 2489 0218 18209FE5 		ldr	r2, .L15+4
 2490 021c 002092E5 		ldr	r2, [r2, #0]
 2491 0220 022682E3 		orr	r2, r2, #2097152
 2492 0224 002083E5 		str	r2, [r3, #0]
 101:../button.c   **** }
 2493              		.loc 1 101 0
 2494 0228 0CD04BE2 		sub	sp, fp, #12
 2495 022c 00689DE8 		ldmfd	sp, {fp, sp, lr}
 2496 0230 1EFF2FE1 		bx	lr
 2497              	.L16:
 2498              		.align	2
 2499              	.L15:
 2500 0234 00000000 		.word	boton_confirmado
 2501 0238 2400E001 		.word	31457316
 2502 023c 5400D201 		.word	30539860
 2503 0240 0800E001 		.word	31457288
 2504 0244 0C00E001 		.word	31457292
 2505 0248 74FF7F0C 		.word	209715060
 2506 024c 00000000 		.word	Eint4567_ISR
 2507 0250 4000D201 		.word	30539840
 2508 0254 FFFF0000 		.word	65535
 2509 0258 4800D201 		.word	30539848
 2510 025c 5000D201 		.word	30539856
 2511 0260 22222222 		.word	572662306
 2512              		.cfi_endproc
 2513              	.LFE2:
 2515              	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 button.c
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2246   .bss:00000000 $d
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2247   .bss:00000000 int_count
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2250   .text:00000000 $a
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2252   .text:00000000 boton_confirmado
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2330   .text:000000c0 $d
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2334   .text:000000c4 $a
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2337   .text:000000c4 Eint4567_ISR
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2414   .text:0000016c $d
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2419   .text:00000174 $a
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2422   .text:00000174 Eint4567_init
C:\Users\jaime\AppData\Local\Temp\ccCRbK68.s:2500   .text:00000234 $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
timer2_count
cola_depuracion
D8Led_symbol
timer3_start_antirrebote
timer3_init
